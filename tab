// 2) Flux SSE temps réel (les clients s’abonnent ici)
  @GetMapping(path = "/{version}/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
  public SseEmitter stream(@PathVariable String version) {
    // Timeout côté serveur : 0L = pas de timeout (ou par ex. 30mn = 30*60*1000)
    SseEmitter emitter = sse.subscribe(version, 0L);

    // Option : envoyer l’état actuel immédiatement (pratique pour reprendre un flux)
    String current = copyStatusRepo.findTopByVersionOrderByUpdatedAtDesc(version)
        .map(CopyStatusEntity::getStatus).orElse("UNKNOWN");
    try {
      emitter.send(SseEmitter.event().name("progress")
          .data(Map.of("version", version, "copyStatus", current)));
    } catch (Exception ignored) {}

    return emitter;
  }
