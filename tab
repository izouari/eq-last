Envoi dâ€™Emails â€“ Notification Automatique
ğŸ¯ Objectif

Lâ€™objectif est dâ€™envoyer automatiquement des emails de notification (par exemple : publication de rÃ©fÃ©rentiels) en utilisant JavaMailSender et des templates FreeMarker.
Ce module permet de gÃ©nÃ©rer des emails dynamiques en HTML basÃ©s sur des donnÃ©es mÃ©tiers (NotifEmailDto).

ğŸ—ï¸ Architecture Technique
1. Configuration du MailSender

La configuration du client SMTP est dÃ©finie dans la classe MailSenderConfig.

@@@@@Code : MailSenderConfig



ğŸ‘‰ Cette configuration permet :

dâ€™initialiser le client SMTP,

de dÃ©finir les propriÃ©tÃ©s (host, protocol, debugâ€¦),

de sâ€™appuyer sur les propriÃ©tÃ©s applicatives (MailProperties).




2. Service dâ€™Envoi dâ€™Email

Le service EmailService encapsule la logique dâ€™envoi via JavaMailSender et FreeMarker.

@@@@@@@@Code : sendEmailWithTemplate


ğŸ‘‰ Ici :

FreeMarker est utilisÃ© pour gÃ©nÃ©rer le contenu HTML en injectant les variables,

JavaMailSender se charge de lâ€™envoi effectif,

La gestion dâ€™erreurs est centralisÃ©e avec BusinessErrorMessage.



3. Enum MailSender

Lâ€™enum MailSender permet de dÃ©finir diffÃ©rents types de mails avec leur template associÃ©.

@@@@@@@Code : MailSender



4. Scheduler

La classe SchedulerEmailNotif orchestre lâ€™exÃ©cution pÃ©riodique et dÃ©clenche lâ€™envoi dâ€™email.

Exemple : notification de publication


@@@@@@@@Code : SchedulerEmailNotif

onnes pratiques

Externaliser les templates .ftl dans src/main/resources/templates.

Garder le service gÃ©nÃ©rique â†’ EmailService ne doit pas contenir de logique mÃ©tier.

Utiliser lâ€™enum MailSender pour centraliser les types de mails.

Logger systÃ©matiquement les tentatives dâ€™envoi (succÃ¨s/Ã©chec).

Activer le mode debug SMTP en recette (mail.debug=true), mais dÃ©sactiver en prod.

PrÃ©voir des tests unitaires sur :

la construction des variables injectÃ©es,

la gÃ©nÃ©ration du NotifEmailDto,

le fallback en cas de TemplateException



spring:
  mail:
    host: smtp.mycorp.local
    # â€¦ autres props communes

---
spring:
  config:
    activate:
      on-profile: recette
  mail:
    properties:
      mail.debug: true

---
spring:
  config:
    activate:
      on-profile: prod
  mail:
    properties:
      mail.debug: false


Ensuite, lance ton app avec le profil voulu :

Recette : -Dspring.profiles.active=recette

Prod : -Dspring.profiles.active=prod

En K8s/Docker, tu peux aussi piloter Ã§a par variable dâ€™environnement :
SPRING_MAIL_PROPERTIES_MAIL_DEBUG=true|false.
